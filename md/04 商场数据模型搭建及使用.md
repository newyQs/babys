# 第4章 商场的数据模型搭建与使用

## 4.1 定义商场的数据模型

模型定义的功能说明：
(1) 定义模型字段：26个
AutoField：自增长类型，数据表的字段类型为整数，长度为11位
BigAutoField：自增长类型，数据表的字段类型为bigint，长度为20位
CharField：字符类型
BooleanField：布尔类型
CommaSeparateIntegerField：用逗号分隔的整数类型
DateField：日期(Date)类型
DateTimeField：日期时间(Datetime)类型
Decimal：十进制小数类型
EmailField：字符类型，存储邮箱格式的字符串
FloatField：浮点数类型，数据表字段类型变成Double类型
IntegerField：整数类型，
BigIntegerField
IPAddressField
GenericIPAddressField
NullBooleanField
PositiveIntegerField
PositiveSmallIntegerField
SlugField：
SmallIntegerField：小整数类型，取值范围为-32768~+32767
TextField：长文本类型
TimeField：时间类型，显示时分秒HH:MM[:SS[.uuuuuu]]
URLField：字符类型，存储路由格式的字符串
BinaryField：二进制数据类型
FileField：字符类型，存储文件路径的字符串
ImageField：字符类型，存储图片路径的字符串
FilePathField：字符类型，从特定的文件目录选择某个文件

(2) 字段类型的属性：20个
verbose_name：默认为None，在Admin站点管理设置字段的显示名称
primary_key：默认为False，若为True，则将字段设置成主键
max_length：默认为None，设置字段的最大长度
unique：默认为False，若为True，则设置字段的唯一熟悉
blank：默认为False，若为True，则字段允许为空值，数据库将存储空字符串
null：默认为False，若为True，则字段允许为空值，数据库表现为NULL
db_index：
default：默认为NOT_PROVIDED对象，设置字段的默认值
editable
serialize
unique_for_date
unique_for_month
unique_for_year
choices：默认为空列表，设置字段的可选值
help_text：
db_column：默认为None，设置数据表的列名称，若不设置，则将字段名作为数据表的列名
db_tablespace
auto_created
validators
error_messages

(3) 重写__str__方法


(4) 重写Meta类：19个
abstract
app_label
db_table：属性值为字符串，设置模型所对应的的数据表名称
db_tablespace
get_latest_by
managed
order_with_respect_to
ordering：属性值为列表，将模型数据以某个字段进行排序
permissions
proxy
required_db_features
required_db_vendor
select_on_save
indexes
unique_together
verbose_name
verbose_name_plural
label
label_lower

## 4.2 数据迁移创建数据表
(1) 创建数据库迁移表
python manage.py makemigations

(2) 迁移所有数据表
python manage.py migrate

(3) 迁移指定的数据表
python manage.py migrate commodity 0001_initial

(4) 查看迁移sql执行语句
python manage.py sqlmigrate commodity 0001_initial

## 4.3 数据的导入与导出


## 4.4 使用QuerySelect操作数据

(1)新增数据
```python
from commodity.models import CommodityType

# 方法一
t = CommodityType()
t.firsts = "童装"
t.seconds = "女装"
t.save()

# 方法二
t = CommodityType(firsts="儿童早教", seconds="童话故事")
t.save()

# 方法三
t = CommodityType.objects.create(firsts="儿童用品", seconds="婴儿车")

# 方法四
d = dict(firsts="奶粉辅食", seconds="磨牙饼干")
t = CommodityType.objects.create(**d)
```

(2)去重数据
```python
from commodity.models import CommodityType

d=dict(firsts="奶粉辅食",seconds="磨牙饼干")
t=CommodityType.objects.get_or_create(**d)

T=CommodityType.objects.update_or_create(**d)
```

(3)更新数据
```python
from commodity.models import CommodityType

# 方法1
t=CommodityType.objects.get(id=1)
t.firsts="儿童用品"
t.save()

# 方法2
CommodityType.objects.filter(id=1).update(seconds="男装")

d=dict(seconds="童鞋")
CommodityType.objects.filter(id=1).update(**d)

# 不使用查询方法，默认对全表的数据进行更新
CommodityType.objects.update(firsts="母婴食品")

# 内置F方法实现数据的自增或自减
from django.db.models import F
t=CommodityType.objects.filter(id=1)
# 将id原有的数据自增加10，自增或自减的字段必须为数字类型
t.update(id=F('id')+10)

# 批量更新
t1=CommodityType.objects.create(firsts="奶粉辅食",seconds="纸尿片")
t2=CommodityType.objects.create(firsts="儿童用品",seconds="进口奶粉")
t1.firsts="儿童用品"
t2.seconds="婴儿车"
CommodityType.objects.bulk_update([t1,t2],fields=['firsts','seconds'])
```

(5)删除数据
```python
from commodity.models import CommodityType

CommodityType.objects.all().delete()

CommodityType.objects.get(id=1).delete()

CommodityType.objects.filter(firsts="儿童用品").delete()
```

查询数据
```python
from index.models import VocationInfo

# 全表查询
# SQL: select * from index_vocation
v=VocationInfo.objects.all()

# 查询前3条数据
# SQL: select * from index_vocation limit 3
# SQL语句中的limit方法，在django中使用列表截取即可
v=VocationInfo.objects.all()[:3]

# 查询某个字段
# SQL: select job from index_vocation


```