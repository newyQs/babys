# 第5章 商城的数据业务处理

## 5.1 首页的视图函数

```python
from django.shortcuts import render
from commodity.models import *


def indexView(request):
    # title = '首页'
    # class_content = ''
    # commodity_info = CommodityInfo.objects.order_by('-sold').all()[:8]
    types = CommodityType.objects.all()

    cl = [x.seconds for x in types if x.firsts == "儿童服饰"]
    clothes = CommodityInfo.objects.filter(types__in=cl).order_by('-sold')[:5]

    fl = [x.seconds for x in types if x.firsts == "奶粉辅食"]
    foods = CommodityInfo.objects.filter(types__in=fl).order_by('-sold')[:5]

    gl = [x.seconds for x in types if x.firsts == "儿童用品"]
    goods = CommodityInfo.objects.filter(types__in=gl).order_by("-sold")[:5]

    return render(request, 'index.html', locals())
```

## 5.2 视图的请求对象

请求方式：8种
```text
GET：
POST：
PUT：
DELETE：
HEAD：
TRACE：
CONNECT：
OPTIONS：
```

对于django来说，当它接收到HTTP请求后，会根据HTTP请求携带的请求参数以及请求信息来创建一个**WSGIRequest对象**，并且作为视图函数的首个参数。
该参数包含用户所有的请求信息，该请求参数(request)常用的属性如下：
```text
COOKIE
FILES
GET
POST
META
method
path
user

```

HTTPRequest的常用方法：
```text
is_secure()
is_ajax()
get_host()
get_full_path()
get_raw_uri()

```

## 5.3 视图的响应方式

响应类
```text
HttpResponse("hello word")          状态码200
HttpResponseRedirect("/")           状态码302
HttpResponsePermanentRedirect("/")  状态码301
HttpResponseBadRequest("400")       状态码400
HttpResponseNotFound("404")         状态码404
HttpResponseForbidden("403")        状态码403
HttpResponseNotAllowed("405")       状态码405
HttpResponseServerError("500")      状态码500
JsonResponse({"foo":"bar"})         状态码200
StreamingHttpResponse()             状态码200

```

## 5.4 认识视图类
视图类是通过定义和声明类的形式实现的，根据用户划分为3个部分：数据显示视图、数据操作视图和日期筛选视图。

数据显示视图
数据操作视图
日期筛选视图

## 5.5 使用视图类实现商城首页
```python
from commodity.models import *
from django.views.generic.base import TemplateView

class indexClassView(TemplateView):
    template_name = 'index.html'
    template_engine = None
    content_type = None
    extra_context = {"title": "首页", "class_content": ""}

    def get_context_data(self, **kwargs):
        context = super(indexClassView, self).get_context_data(**kwargs)
        context["commodity_info"] = CommodityInfo.objects.order_by('-sold').all()[:8]
        types = CommodityType.objects.all()

        cl = [x.seconds for x in types if x.firsts == "儿童服饰"]
        context["clothes"] = CommodityInfo.objects.filter(types__in=cl).order_by('-sold')[:5]

        fl = [x.seconds for x in types if x.firsts == "奶粉辅食"]
        context["foods "] = CommodityInfo.objects.filter(types__in=fl).order_by('-sold')[:5]

        gl = [x.seconds for x in types if x.firsts == "儿童用品"]
        context["goods"] = CommodityInfo.objects.filter(types__in=gl).order_by("-sold")[:5]

        return context

    def get(self, request, *args, **kwargs):
        context = self.get_context_data(**kwargs)
        return self.render_to_response(context)

    def post(self, request, *args, **kwargs):
        context = self.get_context_data(**kwargs)
        return self.render_to_response(context)
```
## 5.6 本章小结
 